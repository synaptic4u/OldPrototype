update journal 
   set section1 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section2 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section3 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section4 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section5 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section6 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section7 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section8 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.",
       section9 = "In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.In the problem below, the primary key is being replace with a new 128bit random hash instead.";












-- In the problem below, the primary key is being replace with a new 128bit random hash instead.
-- pki was generated from scratch with "update record set pki = uuid_to_bin(UUID()) WHERE 1 = 1". 
-- We now need to go loop through each record_ext_dtype_position entry and update its value for `fki_record_id` to be the same as the pki in record table. Currently record_ext_dtype_position.fk_record_id relates to record.id

CREATE TABLE `record` (
  `pki` varbinary(16) NOT NULL,
  `id` int unsigned NOT NULL AUTO_INCREMENT COMMENT '@depreciate, don''t use',
  `enum_mode` enum('default','manual','automatic') NOT NULL DEFAULT 'default',
  `uint32_t_created` datetime DEFAULT NULL,
  `uint32_t_modified` datetime DEFAULT NULL,
  `uint32_t_detected` datetime DEFAULT NULL,
  `uint8_t_timezone` int NOT NULL DEFAULT '200' COMMENT 'GMT offset eg 0200',
  `uint8_t_locale` varchar(8) NOT NULL DEFAULT 'en/za',
  `bool_moderated` tinyint unsigned NOT NULL DEFAULT '1',
  `bool_processed` tinyint unsigned NOT NULL DEFAULT '0',
  `bool_exists` tinyint unsigned NOT NULL DEFAULT '1',
  `fki_program_id` varbinary(16) DEFAULT NULL,
  `fki_device_id` varbinary(16) NOT NULL COMMENT 'UUID_TO_BIN(''00000000-0000-0000-0000-000000000000'') Is the default ',
  PRIMARY KEY (`pki`,`bool_exists`),
  UNIQUE KEY `id_UNIQUE` (`id`,`bool_exists`),
  KEY `fk_device_idx` (`fki_device_id`),
  KEY `hash_index` (`pki`) USING BTREE,
  KEY `id_exists` (`bool_exists`),
  KEY `fk_program_pki` (`fki_program_id`),
  CONSTRAINT `fk_device_uuid` FOREIGN KEY (`fki_device_id`) REFERENCES `device` (`uuid`),
  CONSTRAINT `fk_program_pki` FOREIGN KEY (`fki_program_id`) REFERENCES `project` (`pki`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=95607 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `record__ext_dtype_position` (
  `pki` varbinary(16) NOT NULL COMMENT 'New primary key to replace autoincr',
  `id` int NOT NULL AUTO_INCREMENT,
  `fk_record_id` int DEFAULT NULL,
  `fki_record_id` varbinary(16) NOT NULL,
  `uint32_t_created` datetime DEFAULT NULL,
  `uint32_t_modified` datetime DEFAULT NULL,
  `float_latitude` float DEFAULT NULL,
  `float_latitude_uere` float DEFAULT NULL COMMENT 'UERE (in meters) or User’s Equivalent Range Error = UERE',
  `float_longitude` float DEFAULT NULL,
  `float_longitude_uere` float DEFAULT NULL COMMENT 'UERE (in meters) or User’s Equivalent Range Error = UERE',
  `point_position` point DEFAULT NULL COMMENT 'A 2D location, a pair of numbers.  ',
  `point_position_uere` point DEFAULT NULL COMMENT 'maximum absolute error in computers = epsilon\n\nmaximum relative error = MAE (stats) \n\nUERE (in meters) or User’s Equivalent Range Error = UERE',
  `float_velocity` float DEFAULT NULL COMMENT 'ms^-1',
  `float_altitude` float DEFAULT NULL,
  `uint32_satellite_visible` int DEFAULT NULL,
  `uint32_satellite_locked` int DEFAULT NULL,
  `set_flags` set('SYSTEM','NOTALTERED','HIDDEN','IMMUTABLE','PROTECTED','ARCHIVED','TRIMMED') NOT NULL DEFAULT 'NOTALTERED',
  PRIMARY KEY (`pki`),
  UNIQUE KEY `id_UNIQUE` (`id`),
  KEY `fk_record_id_idx` (`fk_record_id`),
  KEY `id_flags` (`set_flags`)
) ENGINE=InnoDB AUTO_INCREMENT=73108 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE DEFINER=`human`@`%` TRIGGER `record_ext_position_BEFORE_UPDATE` BEFORE UPDATE ON `record_ext_dtype_position` FOR EACH ROW BEGIN
    SET NEW.set_flags := replace(NEW.set_flags, 'NOTALTERED','');
    SET NEW.set_flags := (SELECT CASE WHEN (SELECT bool_exists from record INNER JOIN record__ext_dtype_position pp ON record.id = pp.`fk_record_id` WHERE record.id = pp.`fk_record_id`) = 0 THEN replace(NEW.set_flags, 'TRIMMED', '') ELSE NEW.set_flags END);

IF NEW.set_flags = 'PROTECTED' THEN
        SIGNAL SQLSTATE '45020'
        SET MESSAGE_TEXT := 'Can not update record as it is marked as PROTECTED';
ELSE 
	SET NEW.uint32_t_modified := (SELECT NOW());
	SET NEW.point_position=ST_GeomFromText(CONCAT('POINT (',NEW.float_latitude,' ',NEW.float_longitude,')'), 4326);
	SET NEW.point_position_uere=ST_GeomFromText(CONCAT('POINT (',NEW.float_latitude_uere,' ',NEW.float_longitude_uere,')'), 0);
END IF;
END


-- Write a update query that sets fki_record_id to the value of pki in the record table
UPDATE `record_ext_dtype_position` SET fki_record_id = (SELECT pki FROM record WHERE record.id = record_ext_dtype_position.fk_record_id)


UPDATE `record_ext_dtype_position`  
   SET fki_record_id = (SELECT pki 
                         FROM record
                        WHERE record.id = record_ext_dtype_position.fk_record_id 
                        GROUP BY record_ext_dtype_position.fki_record_id )	

update `record_ext_dtype_position`, `record`
 inner join `record_ext_dtype_position`
    on record.id = recordext_dtype_position.fk_record_id
   set fki_record_id = pki

-------------------------------------------------------------
-------------------------------------------------------------   

insert into application_modules(`appid`, `title`, `controller`, `method`, `submoduleid`, `view`, `create`, `edit` ,`delete`)values(  2,  'Organization Builder',  'Hierachy',  'load',  0,  1,  1,  1,  1);

insert into application_modules(`appid`, `title`, `controller`, `method`, `submoduleid`, `view`, `create`, `edit` ,`delete`)values(  2,  'Organization Builder',  'Hierachy',  'show',  0,  1,  1,  1,  1);
insert into application_modules(`appid`, `title`, `controller`, `method`, `submoduleid`, `view`, `create`, `edit` ,`delete`)values(  2,  'Organization Details',  'Hierachy',  'detail',  0,  1,  1,  1,  1);


update application_modules 
   set `view` = 1,
       `create` = 1,
       `edit` = 1,
       `delete` = 1
 where moduleid = 10;


select * 
  from hierachy_users hu
  join hierachy_module_roles hmr
    on hu.roleid = hmr.roleid
  join application_modules am
    on hmr.moduleid = am.moduleid
 where hu.userid = 7;

  join hierachy_module_users hmu
    on hur.roleid = hmu.roleid
  join application_modules am
    on hmu.moduleid = am.moduleid
 where hur.userid = 7;

select * 
  from hierachy_module_users hmu
  join application_modules am
    on hmu.moduleid = am.moduleid
 where hmu.userid = 7;


select count(distinct am.appid) as count
  from hierachy_module_users hmu
  join application_modules  am
    on hmu.moduleid = am.moduleid
 where hmu.userid = 7;


select a.name as app, max(hmr.updatedon) as app_last_edited
  from hierachy_applications ha
  join applications a 
    on ha.appid = a.appid
  left join application_modules am
    on ha.appid = am.appid
  left join ( select m.moduleid,
                case when isnull(max(r.updatedon)) then max(u.updatedon) 
                        when isnull(max(u.updatedon)) then max(r.updatedon)
                        when isnull(max(u.updatedon)) && isnull(max(r.updatedon)) then null 
                        else case when max(r.updatedon) > max(u.updatedon) then max(r.updatedon) else max(u.updatedon) end end as updatedon
                from application_modules m
                left join hierachy_module_roles r
                  on m.moduleid = r.moduleid
                left join hierachy_module_users u
                  on m.moduleid = u.moduleid
               group by m.moduleid) hmr
     on am.moduleid = hmr.moduleid
  where ha.appid = 1
    and ha.hierachyid = 40
  group by a.name;



  select ha.appid,
          a.name as app,
          am.moduleid, am.title as module, amm.title as parent_mod,
          am.submoduleid, am.view, am.create, am.edit, am.delete,
          hmr.updatedon as last_edited, concat(u.firstname, " ", u.surname) as maintainedby
    from hierachy_applications ha
    join applications a 
      on ha.appid = a.appid
    left join application_modules am
      on ha.appid = am.appid
    left join application_modules amm
      on am.submoduleid = amm.moduleid
    left join (select case when max(r.updatedon) > max(u.updatedon) then  r.moduleid else u.moduleid end as moduleid, 
                      case when max(r.updatedon) > max(u.updatedon) then max(r.updatedon) else max(u.updatedon) end as updatedon, 
                      case when max(r.updatedon) > max(u.updatedon) then r.maintainedby else u.maintainedby  end as maintainedby
                 from hierachy_module_roles r
                 left join hierachy_module_users u
                   on r.moduleid = u.moduleid
                group by r.moduleid, u.moduleid) hmr
      on am.moduleid = hmr.moduleid
    left join users u
      on hmr.maintainedby = u.userid
    order by am.moduleid;


 select m.moduleid, m.title,
        case  when isnull(max(r.updatedon)) then max(u.updatedon) 
              when isnull(max(u.updatedon)) then max(r.updatedon)
              when isnull(max(u.updatedon)) && isnull(max(r.updatedon)) then null 
              else case when max(r.updatedon) > max(u.updatedon) then max(r.updatedon) else max(u.updatedon) end end as updatedon,
        case  when isnull(max(r.updatedon)) then max(u.maintainedby) 
              when isnull(max(u.updatedon)) then max(r.maintainedby)
              when isnull(max(u.updatedon)) && isnull(max(r.updatedon)) then null 
              else case when max(r.updatedon) > max(u.updatedon) then max(r.maintainedby) else max(u.maintainedby) end end as maintainedby
   from application_modules m
   left join hierachy_module_roles r
     on m.moduleid = r.moduleid
   left join hierachy_module_users u
     on m.moduleid = u.moduleid
  group by m.moduleid, m.title



select ha.appid, ha.updatedon as last_edited,
       a.name as app,
       am.moduleid, am.title as module, amm.title as parent_mod,
       am.submoduleid, am.view, am.create, am.edit, am.delete
  from hierachy_applications ha
  join applications a 
    on ha.appid = a.appid
  left join application_modules am
    on ha.appid = am.appid
  left join application_modules amm
    on am.submoduleid = amm.moduleid
 where ha.appid = 1
   and ha.hierachyid = 40
 order by am.moduleid;


select hr.hierachyid, hr.roleid, hr.name as `role`, hr.updatedon, hr.maintainedby as userid, 
 		case when hr.maintainedby = 3 then "System Default" else concat(u.firstname, " ", u.surname) end as `user`, 
 		hr.`exclude`, hr.dependants, hr.`view`, hr.`create`, hr.`edit`, hr.`delete`
  from hierachy_roles hr 
  join users u 
    on hr.maintainedby = u.userid
 where hr.hierachyid = 0
    or hr.hierachyid = 40
 order by hr.name ASC;


select logid, location, loggedon
  from logs 
 where loggedon >= "2022-01-07 11:35:30" 
   and location like "% FLOW DIAGRAM" 
 order by logid asc;

alter table application_modules add column `view` int(11) default 0;
alter table application_modules add column `create` int(11) default 0;
alter table application_modules add column `edit` int(11) default 0;
alter table application_modules add column `delete` int(11) default 0;

insert into application_modules(`title`, `controller`, method, createdon, updatedon, appid, submoduleid)
select title, controller, method, createdon, updatedon, appid, submenuid from application_menus;


insert into applications(`name`, `description`)values("Hierachy", "The hierachy application package is a default system package that manages all settings for your organizational hierachy structure.");


CREATE TABLE `hierachy_app_users` (
  `hierachyid` int(11) not null,
  `appid` int(11) NOT NULL,
  `roleid` int(11) NOT NULL,
  `userid` int(11) NOT NULL,
  `addedon` datetime NOT NULL DEFAULT current_timestamp(),
  KEY `hierachyid` (`hierachyid`),
  KEY `appid` (`appid`),
  KEY `roleid` (`roleid`),
  KEY `userid` (`userid`),
  CONSTRAINT `hierachy_app_users_hierachyid_fk` FOREIGN KEY (`hierachyid`) REFERENCES `users` (`hierachyid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `hierachy_app_users_appid_fk` FOREIGN KEY (`appid`) REFERENCES `applications` (`appid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `hierachy_app_users_roleid_fk` FOREIGN KEY (`roleid`) REFERENCES `hierachy_roles` (`roleid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `hierachy_app_users_userid_fk` FOREIGN KEY (`userid`) REFERENCES `users` (`userid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `users_forgot_password` (
  `forgotid` int(11) not null auto_increment,
  `userid` int(11) NOT NULL,
  `datedon` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`forgotid`),
  KEY `userid` (`userid`),
  CONSTRAINT `users_forgot_password_userid_fk` FOREIGN KEY (`userid`) REFERENCES `users` (`userid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `notifications` (
  `noteid` int(11) not null,
  `hierachyid` int(11) NOT NULL,
  `from_userid` int(11) NOT NULL,
  `to_userid` int(11) NOT NULL,
  `appid` int(11) DEFAULT NULL,
  `request` text default null,
  `datedon` datetime NOT NULL DEFAULT current_timestamp(),
  PriMARY KEY (`noteid`),
  KEY `hierachyid` (`hierachyid`),
  KEY `from_userid` (`from_userid`),
  KEY `to_userid` (`to_userid`),
  KEY `appid` (`appid`),
  CONSTRAINT `notifications_from_userid_fk` FOREIGN KEY (`from_userid`) REFERENCES `users` (`userid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `notifications_to_userid_fk` FOREIGN KEY (`to_userid`) REFERENCES `users` (`userid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `notifications_hierachyid_fk` FOREIGN KEY (`hierachyid`) REFERENCES `hierachy` (`hierachyid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `notifications_appid_fk` FOREIGN KEY (`appid`) REFERENCES `applications` (`appid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `invites` (
  `inviteid` int(11) not null,
  `hierachyid` int(11) NOT NULL,
  `from_userid` int(11) NOT NULL,
  `to_userid` int(11) NOT NULL,
  `appid` int(11) DEFAULT NULL,
  `email` text default null,
  `datedon` datetime NOT NULL DEFAULT current_timestamp(),
  PriMARY KEY (`inviteid`),
  KEY `hierachyid` (`hierachyid`),
  KEY `from_userid` (`from_userid`),
  KEY `to_userid` (`to_userid`),
  KEY `appid` (`appid`),
  CONSTRAINT `invites_from_userid_fk` FOREIGN KEY (`from_userid`) REFERENCES `users` (`userid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `invites_to_userid_fk` FOREIGN KEY (`to_userid`) REFERENCES `users` (`userid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `invites_hierachyid_fk` FOREIGN KEY (`hierachyid`) REFERENCES `hierachy` (`hierachyid`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `invites_appid_fk` FOREIGN KEY (`appid`) REFERENCES `applications` (`appid`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;